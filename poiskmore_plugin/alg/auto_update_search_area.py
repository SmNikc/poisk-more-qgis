class AutoUpdater: def init(self, iface, interval_ms=3600000): # 1 час self.iface = iface self.timer = QTimer() self.timer.timeout.connect(self.update_area) self.timer.start(interval_ms)
def update_area(self): layer = QgsProject.instance().mapLayersByName("Район поиска")[0] if layer: wind_speed = QgsExpressionContextUtils.globalScope().variable('wind_speed') or 5.0 wind_dir = QgsExpressionContextUtils.globalScope().variable('wind_dir') or 0.0 layer.startEditing() for feat in layer.getFeatures(): geom = feat.geometry() dx = wind_speed * cos(radians(wind_dir)) * 0.01 dy = wind_speed * sin(radians(wind_dir)) * 0.01 new_geom = geom.translate(dx, dy) feat.setGeometry(new_geom) layer.updateFeature(feat) layer.commitChanges() layer.triggerRepaint()