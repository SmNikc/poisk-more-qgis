name: CI: –ü–æ–∏—Å–∫-–ú–æ—Ä–µ –±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
jobs:
  test:
    runs-on: ubuntu-latest
    container: ghcr.io/smnikc/poiskmore-qgis:3.40.9
    steps:
      - name: üì• Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4
      - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          apt-get update && apt-get install -y python3-pip
      - name: üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ flake8
        run: |
          pip install flake8
          flake8 poiskmore_plugin esb --max-line-length=120 --exit-zero
      - name: üß™ –¢–µ—Å—Ç—ã pytest
        run: |
          pip install pytest
          pytest
      - name: üß™ –¢–µ—Å—Ç ActiveMQ –æ—Ç–ø—Ä–∞–≤–∫–∏
        run: |
          python -c "from esb.esb_integration import send_message_via_esb; send_message_via_esb({'type': 'TEST', 'data': 'CI Test'})"